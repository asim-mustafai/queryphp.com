(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{467:function(t,a,s){"use strict";s.r(a);var n=s(12),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述","aria-hidden":"true"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("Testing Is Documentation")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/hunzhiwange/framework/blob/master/tests/Router/SummaryDoc.php",target:"_blank",rel:"noopener noreferrer"}},[t._v("tests/Router/SummaryDoc.php"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("对于一个框架来说路由是一件非常重要的事情，可以说是框架的核心之一吧。路由的使用便捷和理解复杂度以及性能对整个框架来说至关重要。")]),t._v(" "),s("h2",{attrs:{id:"路由解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路由解析","aria-hidden":"true"}},[t._v("#")]),t._v(" 路由解析")]),t._v(" "),s("p",[t._v("QueryPHP 有一个非常独特的地方就是路由设计与其它框架有点出入，我们不需要像 Laravel 5、Thinkphp 5 等框架一样定义路由。")]),t._v(" "),s("h3",{attrs:{id:"laravel-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#laravel-5","aria-hidden":"true"}},[t._v("#")]),t._v(" Laravel 5")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[t._v("Route"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("middleware")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\\'first\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\'second\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Route"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    Route"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("profile\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"thinkphp-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#thinkphp-5","aria-hidden":"true"}},[t._v("#")]),t._v(" ThinkPHP 5")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[t._v("Route"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'blog\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Route"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("id\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\'blog"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("read\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    Route"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("name\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\'blog"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("read\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'html\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\\'id\\' "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \\'\\"),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("d")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\'name\\' "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \\'\\"),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("w")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"fastroute"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fastroute","aria-hidden":"true"}},[t._v("#")]),t._v(" FastRoute")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$r")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addRoute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\"),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("d")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\'handler\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$r")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addRoute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\'handler\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$r")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addRoute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GET")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \\'handler\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("其中 FastRoute 中提供一个路由 10 条路由合并匹配算法非常地高效，QueryPHP 已经吸收。 "),s("a",{attrs:{href:"http://nikic.github.io/2014/02/18/Fast-request-routing-using-regular-expressions.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("合并路由匹配算法"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"swagger-php-注解路由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#swagger-php-注解路由","aria-hidden":"true"}},[t._v("#")]),t._v(" Swagger-php 注解路由")]),t._v(" "),s("p",[t._v("在工作中我们大量使用 swagger-php 来生成 API 文档来定义后台的数据结构，这样子前端和后台也可以同时进行，最后\n可以在一起进行联调。")]),t._v(" "),s("p",[t._v("随着时间的推移，我发现 swagger-php 生成的 OpenApi 规范的数据结构就是一个标准的路由系统。我像可不可以直接\n在这个基础上加入自定义的标签实现整个框架的路由呢，经过不断的完善终于搞定，后面会接着讲。")]),t._v(" "),s("p",[t._v("QueryPHP 框架提供 "),s("code",[t._v("MVC 自动路由")]),t._v(" 并能够智能解析 Restful 请求和基于 OpenApi 3.0 规范的 swagger-php 注解\n路由，文档路由一步搞定。所以我们不需要定义一个 router.php 来注册我们的路由，写好文档路由就自动生成好了，并且\n能够缓存起来加速解析。")]),t._v(" "),s("h2",{attrs:{id:"路由匹配过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#路由匹配过程","aria-hidden":"true"}},[t._v("#")]),t._v(" 路由匹配过程")]),t._v(" "),s("p",[t._v("QueryPHP 会优先进行"),s("code",[t._v("MVC 自动路由")]),t._v("匹配，也包含 "),s("code",[t._v("Restful")]),t._v(" 路由匹配,如果匹配失败就会进行注解路由匹配阶段，如果还是\n匹配失败则会抛出一个路由无法找到的异常。")]),t._v(" "),s("h2",{attrs:{id:"自动-mvc-路由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动-mvc-路由","aria-hidden":"true"}},[t._v("#")]),t._v(" 自动 MVC 路由")]),t._v(" "),s("p",[t._v("很多时候我们不是特别关心它是 GET、POST 还是 Put，我们就想简单输入一个地址就可以访问到我们的控制器。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("路径")]),t._v(" "),s("th",[t._v("匹配控制器")]),t._v(" "),s("th",[t._v("备注")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("/")]),t._v(" "),s("td",[t._v("App\\App\\Controller\\Home::index()")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("/controller/action")]),t._v(" "),s("td",[t._v("App\\App\\Controller\\Controller::action()")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("/:blog/controller/action")]),t._v(" "),s("td",[t._v("Blog\\App\\Controller\\Controller::action()")]),t._v(" "),s("td",[s("code",[t._v(":")]),t._v(" 表示应用")])]),t._v(" "),s("tr",[s("td",[t._v("/dir1/dir2/dir3/controller/action")]),t._v(" "),s("td",[t._v("App\\App\\Controller\\Dir1\\Dir2\\Dir3\\Controller::action()")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("/he_llo-wor/Bar/foo/xYY-ac/controller_xx-yy/action-xxx_Yzs")]),t._v(" "),s("td",[t._v("App\\App\\Controller\\HeLloWor\\Bar\\Foo\\XYYAc\\ControllerXxYy::actionXxxYzs()")]),t._v(" "),s("td")])])]),t._v(" "),s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("如果方法单独成为一个类，则起对应的请求入口为 "),s("code",[t._v("handle")]),t._v("，我们推荐为每一个方法定义一个类，避免与其它方法冲突，而且路由匹配性能最佳。\n框架底层会优先匹配方法单独成类，匹配失败则匹配控制器类对应方法操作，如果还是匹配失败进入注解路由匹配阶段。")])]),t._v(" "),s("p",[t._v("例如访问地址 "),s("code",[t._v("http://queryphp.cn/api/test")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("strict_types"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n* This file is part of the forcodepoem package.\n*\n* The PHP Application Created By Code Poem. <Query Yet Simple>\n* (c) 2018-2099 http://forcodepoem.com All rights reserved.\n*\n* For the full copyright and license information, please view the LICENSE\n* file that was distributed with this source code.\n*/")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Controller"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Api")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n* api tests.\n*\n* @author Name Your <your@mail.com>\n*\n* @since 2018.08.31\n*\n* @version 1.0\n*/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n    * 默认方法.\n    *\n    * @return array\n    */")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("array")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'hello'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'world'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("上面这种就是一个简单粗暴的路由，简单有效，大多数时候可以满足我们系统开发的需求。")])]),t._v(" "),s("h2",{attrs:{id:"自动-restful-路由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动-restful-路由","aria-hidden":"true"}},[t._v("#")]),t._v(" 自动 restful 路由")]),t._v(" "),s("p",[t._v("Restful 已经是一种开发主流，前后端分离的场景我们通常会定义 Restful 路由来向前端提供接口服务。")]),t._v(" "),s("p",[t._v("我们访问同一个 URL 的时候,根据不同的"),s("code",[t._v("请求类型")]),t._v("访问不同的后台。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("路径")]),t._v(" "),s("th",[t._v("请求类型")]),t._v(" "),s("th",[t._v("匹配控制器")]),t._v(" "),s("th",[t._v("备注")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("/car")]),t._v(" "),s("td",[t._v("GET")]),t._v(" "),s("td",[t._v("App\\App\\Controller\\Car::index()")]),t._v(" "),s("td",[t._v("没有参数则请求列表")])]),t._v(" "),s("tr",[s("td",[t._v("/car/5")]),t._v(" "),s("td",[t._v("GET")]),t._v(" "),s("td",[t._v("App\\App\\Controller\\Car::show()")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("/car/5")]),t._v(" "),s("td",[t._v("POST")]),t._v(" "),s("td",[t._v("App\\App\\Controller\\Car::store()")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("/car/5")]),t._v(" "),s("td",[t._v("DELETE")]),t._v(" "),s("td",[t._v("App\\App\\Controller\\Car::destroy()")]),t._v(" "),s("td")]),t._v(" "),s("tr",[s("td",[t._v("/car/5")]),t._v(" "),s("td",[t._v("PUT")]),t._v(" "),s("td",[t._v("App\\App\\Controller\\Car::update()")]),t._v(" "),s("td")])])]),t._v(" "),s("p",[t._v("我们系统会分析 pathInfo，会将"),s("code",[t._v("数字类数据")]),t._v("扔进 params，其它字符将会合并进行上面的 "),s("code",[t._v("自动 MVC 路由")]),t._v("，这个时候没有方法，系统根据\n请求类型自动补全方法完成 Restful 请求.")]),t._v(" "),s("p",[t._v("我们可以通过 Request 中的 params 来访问参数。")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[t._v("\\"),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("Leevel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'request\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("params")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'_param0\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 5")]),t._v("\n")])])]),s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("数字类数据支持多个和跨目录")]),t._v(" "),s("p",[t._v("/car/5/10\n/car/5/foo/bar/10/20")])]),t._v(" "),s("h2",{attrs:{id:"swagger-php-注解路由-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#swagger-php-注解路由-2","aria-hidden":"true"}},[t._v("#")]),t._v(" Swagger PHP 注解路由")]),t._v(" "),s("p",[t._v("上面是一种预热，我们的框架路由设计是这样，优先进行 "),s("code",[t._v("pathInfo")]),t._v(" 解析，如果解析失败将进入注解路由高级解析阶段。")]),t._v(" "),s("h3",{attrs:{id:"基础"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础","aria-hidden":"true"}},[t._v("#")]),t._v(" 基础")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("路径")]),t._v(" "),s("th",[t._v("匹配控制器")]),t._v(" "),s("th",[t._v("备注")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("http://127.0.0.1:9527/api")]),t._v(" "),s("td",[t._v("OpenApi 3 JSON")]),t._v(" "),s("td",[t._v("JSON 结构")])]),t._v(" "),s("tr",[s("td",[t._v("http://127.0.0.1:9527/apis/")]),t._v(" "),s("td",[t._v("Swagger-ui")]),t._v(" "),s("td",[t._v("Swagger-ui 入口")])]),t._v(" "),s("tr",[s("td",[t._v("http://127.0.0.1:9527/api/v1/petLeevelForApi/helloworld")]),t._v(" "),s("td",[t._v("路由")]),t._v(" "),s("td",[t._v("注解路由")])])])]),t._v(" "),s("p",[t._v("访问 "),s("code",[t._v("http://127.0.0.1:9527/api/v1/petLeevelForApi/helloworld")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Hi you,i am petLeevelForApi and it petId is helloworld\n")])])]),s("p",[t._v("在工作大量使用 Swagger-php 来生成注释文档,它其实是一个标准的路由。")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n * @OA\\Get(\n *     path="/api/v1/petLeevelForApi/{petId:[A-Za-z]+}/",\n *     tags={"pet"},\n *     summary="Just test the router",\n *     operationId="petLeevelForApi",\n *     @OA\\Parameter(\n *         in="path",\n *         description="ID of pet to return",\n *         required=true,\n *         @OA\\Schema(\n *             type="integer",\n *             format="int64"\n *         )\n *     ),\n *     @OA\\Response(\n *         response=405,\n *         description="Invalid input"\n *     ),\n *     security={\n *         {"petstore_auth": {"write:pets", "read:pets"}}\n *     },\n *     leevelParams={"args1": "hello", "args2": "world"}\n * )\n *\n * @param mixed $petId\n */')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("petLeevelForApi")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$petId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sprintf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'Hi you,i am petLeevelForApi and it petId is %s'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$petId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("VS Laravel:")]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[t._v("Route"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\\'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("看起来我们的路由复杂很多，实际上我们只是定义 "),s("code",[t._v("Leevel")]),t._v(" 开头的属性才是我们的扩展配置。\nQueryPHP 的注解路由，在标准 Swagger-php 的基础上增加了自定义属性扩展功能。")]),t._v(" "),s("h3",{attrs:{id:"单条路由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单条路由","aria-hidden":"true"}},[t._v("#")]),t._v(" 单条路由")]),t._v(" "),s("p",[t._v("系统支持一些自定义属性，可以扩展看路由的功能。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('leevelScheme = "https",\nleevelDomain = "{subdomain:[A-Za-z]+}-vip.{domain}",\nleevelParams = {"args1": "hello", "args2": "world"},\nleevelMiddlewares = "api"\nleevelBind = "\\XXX\\XXX\\class@method"\n')])])]),s("div",{staticClass:"danger custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),s("p",[t._v("leevelBind 未设置自动绑定当前注释的控制器和方法\n文档注释未写到控制器上，这个时候没有上下文控制器，需要使用 leevelBind 绑定\nleevelBind 未设置 "),s("code",[t._v("@")]),t._v(" 则绑定到类的 "),s("code",[t._v("handle")]),t._v(" 方法，"),s("code",[t._v("@")]),t._v(" 可以自定义绑定方法")])]),t._v(" "),s("p",[t._v("路由地址 path 支持正则参数")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/api/v1/petLeevelForApi/{petId:[A-Za-z]+}/\n")])])])])},[],!1,null,null,null);a.default=e.exports}}]);